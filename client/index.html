<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhoDat? â€” The Party Guessing Game</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #F6F5F0;
  --surface: #FFFFFF;
  --surface-alt: #EEEDEA;
  --border: #D8D6D0;
  --border-light: #E8E7E3;

  --green: #1A8C4E;
  --green-light: #E8F5EE;
  --green-dark: #14693A;
  --green-bright: #22C55E;

  --purple: #2D1B4E;
  --purple-mid: #4A3270;
  --purple-light: #F0ECF5;
  --purple-faint: #E8E2F0;

  --text: #1C1917;
  --text-secondary: #78716C;
  --text-muted: #A8A29E;

  --red: #DC2626;
  --red-light: #FEF2F2;
  --amber: #D97706;
  --amber-light: #FFFBEB;

  --radius: 12px;
  --radius-sm: 8px;
  --radius-full: 100px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
  --shadow: 0 1px 3px rgba(0,0,0,0.07), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.08);

  --font-display: 'Bricolage Grotesque', serif;
  --font-body: 'DM Sans', sans-serif;
}

html { height: 100%; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  min-height: 100%;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app {
  max-width: 560px;
  margin: 0 auto;
  padding: 16px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.screen { display: none; flex-direction: column; align-items: center; flex: 1; }
.screen.active { display: flex; }

/* â”€â”€â”€ LOGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.logo {
  font-family: var(--font-display);
  font-size: 3.2rem;
  font-weight: 800;
  text-align: center;
  margin: 48px 0 4px;
  color: var(--purple);
  letter-spacing: -0.03em;
  line-height: 1;
}

.logo span {
  color: var(--green);
}

.logo-sub {
  text-align: center;
  color: var(--text-secondary);
  font-size: 0.95rem;
  font-weight: 500;
  margin-bottom: 36px;
}

/* â”€â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  padding: 24px;
  width: 100%;
  box-shadow: var(--shadow-sm);
}

.card + .card { margin-top: 12px; }

/* â”€â”€â”€ INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
input[type="text"], textarea {
  width: 100%;
  padding: 12px 14px;
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text);
  font-family: var(--font-body);
  font-size: 0.95rem;
  font-weight: 500;
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}

input[type="text"]:focus, textarea:focus {
  border-color: var(--green);
  box-shadow: 0 0 0 3px var(--green-light);
}

textarea { resize: none; min-height: 96px; line-height: 1.5; }

::placeholder { color: var(--text-muted); }

label {
  display: block;
  font-weight: 600;
  margin-bottom: 6px;
  font-size: 0.82rem;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.input-group + .input-group { margin-top: 14px; }

/* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 24px;
  border: none;
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: 0.9rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  letter-spacing: 0.01em;
}

.btn:active { transform: scale(0.97); }

.btn-primary {
  background: var(--green);
  color: white;
}
.btn-primary:hover { background: var(--green-dark); }
.btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

.btn-secondary {
  background: var(--surface);
  color: var(--text);
  border: 1.5px solid var(--border);
}
.btn-secondary:hover { border-color: var(--green); color: var(--green); }

.btn-purple {
  background: var(--purple);
  color: white;
}
.btn-purple:hover { background: var(--purple-mid); }

.btn-outline-green {
  background: var(--green-light);
  color: var(--green-dark);
  border: 1.5px solid var(--green);
}

.btn-full { width: 100%; }
.btn + .btn { margin-top: 8px; }

/* â”€â”€â”€ TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.timer-bar {
  width: 100%;
  height: 4px;
  background: var(--surface-alt);
  border-radius: 2px;
  margin: 14px 0;
  overflow: hidden;
}

.timer-bar-fill {
  height: 100%;
  background: var(--green);
  border-radius: 2px;
  transition: width 0.5s linear;
}

.timer-bar-fill.urgent {
  background: var(--red);
  animation: timerFlash 0.6s ease-in-out infinite;
}

@keyframes timerFlash { 50% { opacity: 0.6; } }

.timer-text {
  text-align: center;
  font-size: 1.8rem;
  font-weight: 800;
  font-family: var(--font-display);
  color: var(--green);
  letter-spacing: -0.02em;
}

.timer-text.urgent { color: var(--red); }

/* â”€â”€â”€ PHASE HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.phase-header {
  text-align: center;
  margin-bottom: 16px;
  width: 100%;
}

.phase-tag {
  display: inline-block;
  padding: 4px 12px;
  border-radius: var(--radius-full);
  font-size: 0.72rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 8px;
}

.phase-tag.question { background: var(--green-light); color: var(--green-dark); }
.phase-tag.answering { background: var(--purple-light); color: var(--purple); }
.phase-tag.reveal { background: var(--amber-light); color: var(--amber); }
.phase-tag.guessing { background: var(--purple-faint); color: var(--purple-mid); }
.phase-tag.voting { background: var(--green-light); color: var(--green); }

.phase-title {
  font-family: var(--font-display);
  font-size: 1.6rem;
  font-weight: 800;
  color: var(--purple);
  letter-spacing: -0.02em;
}

.phase-subtitle {
  color: var(--text-secondary);
  font-weight: 500;
  font-size: 0.9rem;
}

.turn-info {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-top: 4px;
  font-weight: 500;
}

/* â”€â”€â”€ QUESTION DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.question-display {
  background: var(--purple);
  color: white;
  border-radius: var(--radius);
  padding: 20px 24px;
  text-align: center;
  font-size: 1.1rem;
  font-weight: 600;
  margin: 12px 0;
  width: 100%;
  line-height: 1.4;
  font-family: var(--font-display);
  letter-spacing: -0.01em;
}

/* â”€â”€â”€ ANSWER CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.answer-card {
  background: var(--surface);
  border: 1.5px solid var(--border-light);
  border-radius: var(--radius);
  padding: 16px 20px;
  margin: 8px 0;
  width: 100%;
  font-size: 0.95rem;
  font-weight: 500;
  line-height: 1.4;
  animation: slideUp 0.35s ease-out;
  position: relative;
  box-shadow: var(--shadow-sm);
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(14px); }
  to { opacity: 1; transform: translateY(0); }
}

.answer-card.reveal-anim {
  animation: revealPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes revealPop {
  0% { opacity: 0; transform: scale(0.92); }
  100% { opacity: 1; transform: scale(1); }
}

.answer-number {
  position: absolute;
  top: -8px;
  left: -8px;
  width: 24px;
  height: 24px;
  background: var(--purple);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.72rem;
  font-weight: 700;
  color: white;
}

/* â”€â”€â”€ PLAYER CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.player-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-full);
  font-weight: 600;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.15s;
  user-select: none;
}

.player-chip:hover { border-color: var(--green); }
.player-chip.selected { border-color: var(--green); background: var(--green-light); color: var(--green-dark); }
.player-chip.assigned { opacity: 0.3; pointer-events: none; }
.player-chip .avatar { font-size: 1rem; }

.player-list-lobby {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 12px 0;
}

/* â”€â”€â”€ GUESS MATCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guess-row {
  display: flex;
  align-items: stretch;
  gap: 10px;
  margin: 6px 0;
  width: 100%;
  animation: slideUp 0.3s ease-out;
}

.guess-answer {
  flex: 1;
  background: var(--surface);
  border: 1.5px solid var(--border-light);
  border-radius: var(--radius-sm);
  padding: 12px;
  font-weight: 500;
  font-size: 0.88rem;
  display: flex;
  align-items: center;
  min-height: 48px;
  cursor: pointer;
  transition: border-color 0.15s;
  line-height: 1.3;
}

.guess-answer:hover { border-color: var(--green); }
.guess-answer.selected { border-color: var(--green); background: var(--green-light); }

.guess-arrow {
  color: var(--text-muted);
  display: flex;
  align-items: center;
  font-size: 0.9rem;
}

.guess-player-slot {
  min-width: 130px;
  background: var(--bg);
  border: 1.5px dashed var(--border);
  border-radius: var(--radius-sm);
  padding: 8px 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.82rem;
  cursor: pointer;
  transition: all 0.15s;
  color: var(--text-muted);
}

.guess-player-slot.filled {
  border-style: solid;
  border-color: var(--green);
  color: var(--green-dark);
  background: var(--green-light);
}

.guess-player-slot:hover { border-color: var(--green); }

/* â”€â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.result-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  border-radius: var(--radius-sm);
  margin: 4px 0;
  width: 100%;
  animation: slideUp 0.3s ease-out;
  font-size: 0.9rem;
}

.result-row.correct { background: var(--green-light); border-left: 3px solid var(--green); }
.result-row.wrong { background: var(--red-light); border-left: 3px solid var(--red); }

.result-icon { font-size: 1.1rem; }
.result-answer { flex: 1; font-weight: 500; }
.result-player { font-weight: 700; color: var(--green-dark); }

/* â”€â”€â”€ SCOREBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.score-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-radius: var(--radius-sm);
  margin: 4px 0;
  width: 100%;
  background: var(--bg);
  animation: slideUp 0.3s ease-out;
}

.score-row:first-child {
  background: var(--green-light);
  border: 1.5px solid var(--green);
}

.score-rank {
  font-family: var(--font-display);
  font-size: 1.2rem;
  font-weight: 800;
  min-width: 36px;
  text-align: center;
  color: var(--purple);
}

.score-name { flex: 1; font-weight: 600; font-size: 0.95rem; }
.score-points {
  font-family: var(--font-display);
  font-size: 1.1rem;
  font-weight: 800;
  color: var(--green);
}

/* â”€â”€â”€ VOTE BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.vote-section { margin: 14px 0; width: 100%; }
.vote-section h3 {
  font-family: var(--font-display);
  font-size: 1rem;
  font-weight: 700;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
  color: var(--purple);
}

.vote-option {
  width: 100%;
  padding: 11px 14px;
  background: var(--surface);
  border: 1.5px solid var(--border-light);
  border-radius: var(--radius-sm);
  color: var(--text);
  font-family: var(--font-body);
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  margin: 5px 0;
  text-align: left;
  transition: all 0.15s;
}

.vote-option:hover { border-color: var(--green); }
.vote-option.voted { border-color: var(--green); background: var(--green-light); color: var(--green-dark); font-weight: 600; }

/* â”€â”€â”€ LOBBY CODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lobby-code {
  font-family: var(--font-display);
  font-size: 2.8rem;
  font-weight: 800;
  letter-spacing: 0.12em;
  text-align: center;
  color: var(--green);
  cursor: pointer;
  transition: opacity 0.15s;
}
.lobby-code:hover { opacity: 0.7; }

.lobby-code-label {
  text-align: center;
  font-size: 0.78rem;
  color: var(--text-muted);
  margin-top: 2px;
  font-weight: 500;
}

/* â”€â”€â”€ WAITING DOTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.waiting-dots::after {
  content: '';
  animation: dots 1.5s steps(4) infinite;
}
@keyframes dots {
  0% { content: ''; }
  25% { content: '.'; }
  50% { content: '..'; }
  75% { content: '...'; }
}

/* â”€â”€â”€ GAME OVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.winner-banner {
  text-align: center;
  padding: 28px;
  background: var(--green-light);
  border: 2px solid var(--green);
  border-radius: var(--radius);
  margin-bottom: 16px;
  width: 100%;
}

.winner-name {
  font-family: var(--font-display);
  font-size: 2.2rem;
  font-weight: 800;
  color: var(--purple);
  letter-spacing: -0.02em;
}

/* â”€â”€â”€ STATUS BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  border-radius: var(--radius-full);
  font-size: 0.68rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.status-badge.host { background: var(--amber-light); color: var(--amber); }
.status-badge.you { background: var(--green-light); color: var(--green); }
.status-badge.disconnected { background: var(--red-light); color: var(--red); }

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--purple);
  color: white;
  border-radius: var(--radius-sm);
  padding: 10px 20px;
  font-weight: 600;
  font-size: 0.88rem;
  z-index: 1000;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  box-shadow: var(--shadow-md);
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* â”€â”€â”€ HELPER TEXT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hint {
  text-align: center;
  color: var(--text-muted);
  font-size: 0.8rem;
  font-weight: 500;
  margin-top: 8px;
}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 500px) {
  .logo { font-size: 2.4rem; }
  .card { padding: 18px; }
  .guess-row { flex-direction: column; gap: 4px; }
  .guess-arrow { transform: rotate(90deg); justify-content: center; }
  .guess-player-slot { min-width: 100%; }
  .lobby-code { font-size: 2rem; }
}

/* â”€â”€â”€ CONFETTI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.confetti-piece {
  position: fixed;
  width: 8px;
  height: 8px;
  top: -10px;
  z-index: 999;
  animation: confettiFall 3s linear forwards;
}

@keyframes confettiFall {
  to { top: 110vh; transform: rotateZ(720deg); opacity: 0; }
}

/* â”€â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.divider {
  width: 100%;
  height: 1px;
  background: var(--border-light);
  margin: 16px 0;
}

/* â”€â”€â”€ MODAL OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(28, 25, 23, 0.45);
  backdrop-filter: blur(4px);
  z-index: 900;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
}

.modal-overlay.open {
  opacity: 1;
  pointer-events: all;
}

.modal {
  background: var(--surface);
  border-radius: var(--radius);
  box-shadow: 0 16px 48px rgba(0,0,0,0.14);
  width: 100%;
  max-width: 460px;
  max-height: 85vh;
  overflow-y: auto;
  transform: translateY(12px) scale(0.97);
  transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.modal-overlay.open .modal {
  transform: translateY(0) scale(1);
}

.modal-header {
  padding: 24px 24px 0;
  text-align: center;
}

.modal-header .emoji {
  font-size: 2.4rem;
  margin-bottom: 8px;
}

.modal-header h2 {
  font-family: var(--font-display);
  font-size: 1.5rem;
  font-weight: 800;
  color: var(--purple);
  letter-spacing: -0.02em;
}

.modal-header p {
  color: var(--text-secondary);
  font-size: 0.9rem;
  font-weight: 500;
  margin-top: 4px;
}

.modal-body {
  padding: 20px 24px 24px;
}

.modal-actions {
  display: flex;
  gap: 10px;
  padding: 0 24px 24px;
}

.modal-actions .btn { flex: 1; }

/* â”€â”€â”€ RULES CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rules-step {
  display: flex;
  gap: 14px;
  padding: 12px 0;
}

.rules-step + .rules-step {
  border-top: 1px solid var(--border-light);
}

.rules-step-num {
  flex-shrink: 0;
  width: 30px;
  height: 30px;
  background: var(--green-light);
  color: var(--green-dark);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  font-size: 0.82rem;
  font-family: var(--font-display);
}

.rules-step-text {
  font-size: 0.9rem;
  line-height: 1.45;
  color: var(--text);
  font-weight: 500;
}

.rules-step-text strong {
  color: var(--purple);
  font-weight: 700;
}

.rules-scoring {
  background: var(--purple-light);
  border-radius: var(--radius-sm);
  padding: 14px 16px;
  margin-top: 4px;
}

.rules-scoring-title {
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 0.88rem;
  color: var(--purple);
  margin-bottom: 8px;
}

.rules-scoring-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--text-secondary);
  padding: 3px 0;
}

.rules-scoring-item span {
  font-weight: 700;
  color: var(--green);
}

/* â”€â”€â”€ HOW TO PLAY LINK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.how-to-play-link {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  color: var(--text-muted);
  font-size: 0.82rem;
  font-weight: 600;
  cursor: pointer;
  padding: 8px 0;
  margin-top: 12px;
  transition: color 0.15s;
  border: none;
  background: none;
  font-family: var(--font-body);
}

.how-to-play-link:hover { color: var(--green); }

.how-to-play-link svg {
  width: 16px;
  height: 16px;
}
</style>
</head>
<body>
<div id="app">
  <!-- â•â•â• SCREEN: HOME â•â•â• -->
  <div id="screen-home" class="screen active">
    <div class="logo">Who<span>Dat</span>?</div>
    <div class="logo-sub">Guess who said what</div>

    <div class="card">
      <div class="input-group">
        <label>Your Name</label>
        <input type="text" id="input-name" placeholder="Enter your name" maxlength="20" autocomplete="off">
      </div>
      <div style="margin-top: 18px;">
        <button class="btn btn-primary btn-full" id="btn-create">Create Lobby</button>
        <button class="btn btn-secondary btn-full" id="btn-show-join">Join a Lobby</button>
      </div>
    </div>

    <div class="card" id="join-section" style="display:none;">
      <div class="input-group">
        <label>Lobby Code</label>
        <input type="text" id="input-code" placeholder="ABCDE" maxlength="5" autocomplete="off" style="text-transform: uppercase; text-align: center; font-size: 1.2rem; letter-spacing: 0.1em; font-weight: 700;">
      </div>
      <button class="btn btn-purple btn-full" id="btn-join" style="margin-top: 14px;">Join Game</button>
    </div>

    <button class="how-to-play-link" id="btn-how-to-play">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      How to Play
    </button>
  </div>

  <!-- â•â•â• SCREEN: LOBBY â•â•â• -->
  <div id="screen-lobby" class="screen">
    <div class="logo" style="font-size: 1.6rem; margin: 16px 0 4px;">Who<span>Dat</span>?</div>
    <div class="card" style="text-align: center;">
      <div style="font-size: 0.78rem; color: var(--text-muted); text-transform: uppercase; font-weight: 700; letter-spacing: 0.08em;">Lobby Code</div>
      <div class="lobby-code" id="display-code" title="Click to copy"></div>
      <div class="lobby-code-label">tap to copy Â· share with friends</div>
    </div>

    <div class="card">
      <label>Players <span id="player-count">0</span>/10</label>
      <div class="player-list-lobby" id="player-list"></div>
    </div>

    <div id="host-controls" style="width: 100%; margin-top: 12px; display: none;">
      <button class="btn btn-primary btn-full" id="btn-start" disabled>Need at least 3 players</button>
    </div>

    <div id="guest-waiting" style="text-align: center; margin-top: 20px; display: none;">
      <p class="waiting-dots" style="color: var(--text-secondary); font-weight: 600;">Waiting for host to start</p>
    </div>
  </div>

  <!-- â•â•â• SCREEN: GAME â•â•â• -->
  <div id="screen-game" class="screen">
    <div id="game-content" style="width: 100%;"></div>
  </div>
</div>

<!-- Welcome Modal -->
<div class="modal-overlay" id="modal-welcome">
  <div class="modal">
    <div class="modal-header">
      <div class="emoji">ğŸ‘‹</div>
      <h2>Welcome to WhoDat?</h2>
      <p>The party guessing game</p>
    </div>
    <div class="modal-body" style="text-align: center; padding-bottom: 8px;">
      <p style="font-size: 0.95rem; font-weight: 500; color: var(--text-secondary);">Have you played before?</p>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" id="btn-welcome-no">Nope, show me!</button>
      <button class="btn btn-primary" id="btn-welcome-yes">Yep, let's go!</button>
    </div>
  </div>
</div>

<!-- Rules Modal -->
<div class="modal-overlay" id="modal-rules">
  <div class="modal">
    <div class="modal-header">
      <div class="emoji">ğŸ“–</div>
      <h2>How to Play</h2>
      <p>It's simple â€” here's the rundown</p>
    </div>
    <div class="modal-body">
      <div class="rules-step">
        <div class="rules-step-num">1</div>
        <div class="rules-step-text"><strong>Create or join a lobby</strong> with at least 3 friends. Share the 5-letter code to invite people.</div>
      </div>
      <div class="rules-step">
        <div class="rules-step-num">2</div>
        <div class="rules-step-text"><strong>The guesser asks a question</strong> â€” something general like "What's the best winter sport?" or "What would you bring to a deserted island?" No self-describing questions!</div>
      </div>
      <div class="rules-step">
        <div class="rules-step-num">3</div>
        <div class="rules-step-text"><strong>Everyone else answers anonymously.</strong> Write whatever you want â€” be honest, be funny, be creative.</div>
      </div>
      <div class="rules-step">
        <div class="rules-step-num">4</div>
        <div class="rules-step-text"><strong>The guesser reads each answer</strong> one by one, then tries to match every answer to the person who wrote it.</div>
      </div>
      <div class="rules-step">
        <div class="rules-step-num">5</div>
        <div class="rules-step-text"><strong>Everyone votes</strong> on the â­ Best Answer and the ğŸ˜‚ Funniest Answer for bonus points.</div>
      </div>
      <div class="rules-step">
        <div class="rules-step-num">6</div>
        <div class="rules-step-text"><strong>Rotate!</strong> Everyone gets to be the guesser 3 times. Most points wins.</div>
      </div>

      <div class="rules-scoring">
        <div class="rules-scoring-title">Scoring</div>
        <div class="rules-scoring-item"><span>+1</span> for each correct guess (guesser earns these)</div>
        <div class="rules-scoring-item"><span>+1</span> bonus for winning â­ Best Answer</div>
        <div class="rules-scoring-item"><span>+1</span> bonus for winning ğŸ˜‚ Funniest Answer</div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-primary btn-full" id="btn-rules-close">Got it!</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let ws = null;
let myId = null;
let lobbyCode = null;
let isHost = false;
let players = [];
let gamePhase = null;
let timerInterval = null;
let timerEnd = null;
let currentGuesser = null;
let currentQuestion = '';
let revealedAnswers = [];
let allAnswers = [];
let answerablePlayers = [];
let guessAssignments = {};
let selectedAnswerForGuess = null;
let myBestVote = null;
let myFunniestVote = null;

// â”€â”€â”€ WEBSOCKET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function connect() {
  const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
  ws = new WebSocket(`${protocol}//${location.host}`);

  ws.onopen = () => console.log('Connected');
  ws.onclose = () => {
    console.log('Disconnected');
    setTimeout(connect, 2000);
  };

  ws.onmessage = (e) => {
    const msg = JSON.parse(e.data);
    handleServerMessage(msg);
  };
}

function send(msg) {
  if (ws && ws.readyState === 1) ws.send(JSON.stringify(msg));
}

// â”€â”€â”€ MESSAGE HANDLER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleServerMessage(msg) {
  switch (msg.type) {
    case 'joined':
      myId = msg.playerId;
      lobbyCode = msg.lobbyCode;
      isHost = msg.isHost;
      showScreen('lobby');
      break;

    case 'error':
      showToast(msg.message);
      break;

    case 'lobby_update':
      players = msg.players;
      renderLobby(msg);
      break;

    case 'timer':
      startTimerDisplay(msg.seconds, msg.endsAt);
      break;

    case 'phase':
      gamePhase = msg.phase;
      if (msg.phase === 'lobby') {
        showScreen('lobby');
      } else if (msg.phase === 'gameover') {
        renderGameOver(msg);
      } else {
        showScreen('game');
        renderPhase(msg);
      }
      break;

    case 'reveal_answer':
      handleRevealAnswer(msg);
      break;

    case 'answer_submitted':
      showToast('Answer submitted!');
      break;

    case 'answer_progress':
      updateAnswerProgress(msg);
      break;
  }
}

// â”€â”€â”€ SCREEN MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(`screen-${name}`).classList.add('active');
}

// â”€â”€â”€ LOBBY RENDERING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLobby(msg) {
  document.getElementById('display-code').textContent = msg.code;
  document.getElementById('player-count').textContent = msg.players.length;

  const list = document.getElementById('player-list');
  list.innerHTML = msg.players.map(p => {
    const badges = [];
    if (p.id === msg.hostId) badges.push('<span class="status-badge host">ğŸ‘‘ Host</span>');
    if (p.id === myId) badges.push('<span class="status-badge you">You</span>');
    if (!p.connected) badges.push('<span class="status-badge disconnected">Offline</span>');
    return `
      <div class="player-chip">
        <span class="avatar">${getAvatar(p.id)}</span>
        ${p.name}
        ${badges.join('')}
      </div>
    `;
  }).join('');

  const hostControls = document.getElementById('host-controls');
  const guestWaiting = document.getElementById('guest-waiting');

  if (isHost) {
    hostControls.style.display = 'block';
    guestWaiting.style.display = 'none';
    const btn = document.getElementById('btn-start');
    if (msg.players.length >= 3) {
      btn.disabled = false;
      btn.textContent = `Start Game Â· ${msg.players.length} players`;
    } else {
      btn.disabled = true;
      btn.textContent = `Need at least 3 players (${msg.players.length}/3)`;
    }
  } else {
    hostControls.style.display = 'none';
    guestWaiting.style.display = 'block';
  }
}

// â”€â”€â”€ PHASE RENDERING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPhase(msg) {
  const gc = document.getElementById('game-content');
  currentGuesser = msg.guesser;

  switch (msg.phase) {
    case 'question': renderQuestionPhase(gc, msg); break;
    case 'answering': renderAnswerPhase(gc, msg); break;
    case 'reveal': renderRevealPhase(gc, msg); break;
    case 'guessing': renderGuessingPhase(gc, msg); break;
    case 'voting': renderVotingPhase(gc, msg); break;
    case 'results': renderResultsPhase(gc, msg); break;
  }
}

function renderQuestionPhase(gc, msg) {
  const isGuesser = msg.guesser.id === myId;

  gc.innerHTML = `
    <div class="phase-header">
      <span class="phase-tag question">Your Question</span>
      <div class="phase-title">${isGuesser ? 'Ask the Group' : `${msg.guesser.name}'s Turn`}</div>
      <div class="turn-info">Turn ${msg.turnNumber} of ${msg.totalTurns} Â· Round ${msg.roundNumber}/${msg.totalRounds}</div>
      <div class="timer-bar"><div class="timer-bar-fill" id="timer-fill"></div></div>
      <div class="timer-text" id="timer-text"></div>
    </div>

    ${isGuesser ? `
      <div class="card">
        <div class="input-group">
          <label>Write a question for everyone</label>
          <textarea id="question-input" placeholder='e.g. "What's the best winter sport?" or "What's a hill you'll die on?"' maxlength="200"></textarea>
        </div>
        <button class="btn btn-primary btn-full" id="btn-submit-question" style="margin-top: 14px;">Submit Question</button>
        <p class="hint">Keep it general â€” nothing self-describing!</p>
      </div>
    ` : `
      <div class="card" style="text-align: center; padding: 32px 24px;">
        <p style="font-size: 1.5rem; margin-bottom: 6px;">${getAvatar(msg.guesser.id)}</p>
        <p style="font-weight: 600;">${msg.guesser.name} is writing a question<span class="waiting-dots"></span></p>
        <p style="color: var(--text-muted); margin-top: 6px; font-size: 0.88rem;">Get ready to answer</p>
      </div>
    `}
  `;

  if (isGuesser) {
    document.getElementById('btn-submit-question').onclick = () => {
      const q = document.getElementById('question-input').value.trim();
      if (!q) return showToast('Write a question first!');
      send({ type: 'submit_question', question: q });
    };
    document.getElementById('question-input').focus();
  }
}

function renderAnswerPhase(gc, msg) {
  currentQuestion = msg.question;
  const isGuesser = msg.guesser.id === myId;

  gc.innerHTML = `
    <div class="phase-header">
      <span class="phase-tag answering">Answer Time</span>
      <div class="phase-title">${isGuesser ? 'Waiting for Answers' : 'Your Answer'}</div>
      <div class="timer-bar"><div class="timer-bar-fill" id="timer-fill"></div></div>
      <div class="timer-text" id="timer-text"></div>
    </div>

    <div class="question-display">"${escapeHtml(msg.question)}"</div>

    ${isGuesser ? `
      <div class="card" style="text-align: center; padding: 32px 24px;">
        <p style="font-weight: 600;">Players are answering<span class="waiting-dots"></span></p>
        <p style="color: var(--text-muted); margin-top: 6px; font-size: 0.88rem;" id="answer-progress">0 submitted</p>
      </div>
    ` : `
      <div class="card">
        <div class="input-group">
          <label>Your Answer</label>
          <textarea id="answer-input" placeholder="Type your answer..." maxlength="300"></textarea>
        </div>
        <button class="btn btn-purple btn-full" id="btn-submit-answer" style="margin-top: 14px;">Submit Answer</button>
      </div>
    `}
  `;

  if (!isGuesser) {
    let submitted = false;
    document.getElementById('btn-submit-answer').onclick = () => {
      if (submitted) return;
      const a = document.getElementById('answer-input').value.trim();
      if (!a) return showToast('Write an answer first!');
      send({ type: 'submit_answer', answer: a });
      submitted = true;
      document.getElementById('btn-submit-answer').disabled = true;
      document.getElementById('btn-submit-answer').textContent = 'âœ“ Submitted';
      document.getElementById('answer-input').disabled = true;
    };
    document.getElementById('answer-input').focus();
  }
}

function updateAnswerProgress(msg) {
  const el = document.getElementById('answer-progress');
  if (el) el.textContent = `${msg.submitted} of ${msg.total} submitted`;
}

function renderRevealPhase(gc, msg) {
  revealedAnswers = [];
  const isGuesser = msg.guesser.id === myId;

  gc.innerHTML = `
    <div class="phase-header">
      <span class="phase-tag reveal">Reveal</span>
      <div class="phase-title">${isGuesser ? 'Read Each Answer' : `${msg.guesser.name} is Reading`}</div>
    </div>

    <div class="question-display">"${escapeHtml(msg.question)}"</div>
    <div id="revealed-answers"></div>
    ${isGuesser ? `
      <button class="btn btn-primary btn-full" id="btn-next-reveal" style="margin-top: 14px;">Show First Answer</button>
    ` : ''}
  `;

  if (isGuesser) {
    document.getElementById('btn-next-reveal').onclick = () => {
      send({ type: 'next_reveal' });
    };
  }
}

function handleRevealAnswer(msg) {
  revealedAnswers.push(msg.answer);
  const container = document.getElementById('revealed-answers');
  if (!container) return;

  container.innerHTML = revealedAnswers.map((a, i) => `
    <div class="answer-card reveal-anim">
      <div class="answer-number">${i + 1}</div>
      ${escapeHtml(a.text)}
    </div>
  `).join('');

  const isGuesser = currentGuesser?.id === myId;
  if (isGuesser) {
    const btn = document.getElementById('btn-next-reveal');
    if (btn) {
      if (msg.index < msg.total - 1) {
        btn.textContent = `Next Answer (${msg.index + 2}/${msg.total})`;
      } else {
        btn.textContent = "Start Guessing â†’";
        btn.onclick = () => send({ type: 'next_reveal' });
      }
    }
  }
}

function renderGuessingPhase(gc, msg) {
  allAnswers = msg.answers;
  answerablePlayers = msg.players;
  guessAssignments = {};
  selectedAnswerForGuess = null;
  const isGuesser = msg.guesser.id === myId;

  if (isGuesser) {
    gc.innerHTML = `
      <div class="phase-header">
        <span class="phase-tag guessing">Guess Time</span>
        <div class="phase-title">Who Said What?</div>
        <div class="timer-bar"><div class="timer-bar-fill" id="timer-fill"></div></div>
        <div class="timer-text" id="timer-text"></div>
      </div>

      <div class="question-display">"${escapeHtml(msg.question)}"</div>

      <div id="guess-rows"></div>

      <label style="margin-top: 14px;">Players</label>
      <div id="player-chips" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 14px;"></div>

      <button class="btn btn-primary btn-full" id="btn-lock-in" disabled>
        ğŸ”’ Lock In Guesses
      </button>
      <p class="hint">Tap an answer, then tap a player to assign</p>
    `;

    renderGuessUI();

    document.getElementById('btn-lock-in').onclick = () => {
      if (Object.keys(guessAssignments).length < allAnswers.length) {
        return showToast('Assign all answers first!');
      }
      send({ type: 'submit_guesses', guesses: guessAssignments });
    };
  } else {
    gc.innerHTML = `
      <div class="phase-header">
        <span class="phase-tag guessing">Guess Time</span>
        <div class="phase-title">${msg.guesser.name} is Guessing</div>
        <div class="timer-bar"><div class="timer-bar-fill" id="timer-fill"></div></div>
        <div class="timer-text" id="timer-text"></div>
      </div>

      <div class="question-display">"${escapeHtml(msg.question)}"</div>

      <div class="card" style="text-align: center; padding: 32px 24px;">
        <p style="font-size: 1.5rem; margin-bottom: 6px;">${getAvatar(msg.guesser.id)}</p>
        <p style="font-weight: 600;">${msg.guesser.name} is matching answers to players<span class="waiting-dots"></span></p>
      </div>
    `;
  }
}

function renderGuessUI() {
  const rows = document.getElementById('guess-rows');
  const chips = document.getElementById('player-chips');
  if (!rows || !chips) return;

  rows.innerHTML = allAnswers.map((a, i) => {
    const assignedPlayerId = guessAssignments[a.id];
    const assignedPlayer = answerablePlayers.find(p => p.id === assignedPlayerId);
    const isSelected = selectedAnswerForGuess === a.id;

    return `
      <div class="guess-row">
        <div class="guess-answer ${isSelected ? 'selected' : ''}"
             onclick="selectAnswerForGuess('${a.id}')">
          <span class="answer-number" style="position:relative;top:0;left:0;margin-right:10px;">${i + 1}</span>
          ${escapeHtml(a.text)}
        </div>
        <div class="guess-arrow">â†’</div>
        <div class="guess-player-slot ${assignedPlayer ? 'filled' : ''}"
             onclick="clearGuess('${a.id}')">
          ${assignedPlayer ? `${getAvatar(assignedPlayer.id)} ${assignedPlayer.name}` : '?'}
        </div>
      </div>
    `;
  }).join('');

  const assignedPlayerIds = Object.values(guessAssignments);
  chips.innerHTML = answerablePlayers.map(p => {
    const isAssigned = assignedPlayerIds.includes(p.id);
    return `
      <div class="player-chip ${isAssigned ? 'assigned' : ''}"
           onclick="assignPlayer('${p.id}')">
        <span class="avatar">${getAvatar(p.id)}</span>
        ${p.name}
      </div>
    `;
  }).join('');

  const lockBtn = document.getElementById('btn-lock-in');
  if (lockBtn) {
    lockBtn.disabled = Object.keys(guessAssignments).length < allAnswers.length;
  }
}

window.selectAnswerForGuess = (answerId) => {
  selectedAnswerForGuess = answerId;
  renderGuessUI();
};

window.assignPlayer = (playerId) => {
  if (!selectedAnswerForGuess) return showToast('Select an answer first!');
  for (const [aid, pid] of Object.entries(guessAssignments)) {
    if (pid === playerId) delete guessAssignments[aid];
  }
  guessAssignments[selectedAnswerForGuess] = playerId;
  selectedAnswerForGuess = null;
  renderGuessUI();
};

window.clearGuess = (answerId) => {
  delete guessAssignments[answerId];
  renderGuessUI();
};

function renderVotingPhase(gc, msg) {
  myBestVote = null;
  myFunniestVote = null;

  gc.innerHTML = `
    <div class="phase-header">
      <span class="phase-tag voting">Vote</span>
      <div class="phase-title">Pick Your Favorites</div>
      <div class="timer-bar"><div class="timer-bar-fill" id="timer-fill"></div></div>
      <div class="timer-text" id="timer-text"></div>
    </div>

    <div class="question-display">"${escapeHtml(msg.question)}"</div>

    <div class="vote-section">
      <h3>â­ Best Answer</h3>
      <div id="vote-best">
        ${msg.answers.map(a => `
          <button class="vote-option" data-id="${a.id}" onclick="voteBest('${a.id}')">
            ${escapeHtml(a.text)}
          </button>
        `).join('')}
      </div>
    </div>

    <div class="vote-section">
      <h3>ğŸ˜‚ Funniest Answer</h3>
      <div id="vote-funniest">
        ${msg.answers.map(a => `
          <button class="vote-option" data-id="${a.id}" onclick="voteFunniest('${a.id}')">
            ${escapeHtml(a.text)}
          </button>
        `).join('')}
      </div>
    </div>
  `;
}

window.voteBest = (id) => {
  myBestVote = id;
  send({ type: 'vote', category: 'best', answerId: id });
  document.querySelectorAll('#vote-best .vote-option').forEach(el => {
    el.classList.toggle('voted', el.dataset.id === id);
  });
};

window.voteFunniest = (id) => {
  myFunniestVote = id;
  send({ type: 'vote', category: 'funniest', answerId: id });
  document.querySelectorAll('#vote-funniest .vote-option').forEach(el => {
    el.classList.toggle('voted', el.dataset.id === id);
  });
};

function renderResultsPhase(gc, msg) {
  const r = msg.guessResults;
  gc.innerHTML = `
    <div class="phase-header">
      <span class="phase-tag question">Results</span>
      <div class="phase-title">${r.correct}/${r.total} Correct</div>
    </div>

    <div class="card">
      <label>Guesses</label>
      ${r.results.map(res => `
        <div class="result-row ${res.correct ? 'correct' : 'wrong'}">
          <div class="result-icon">${res.correct ? 'âœ…' : 'âŒ'}</div>
          <div class="result-answer">"${escapeHtml(res.answerText)}"</div>
          <div>
            ${res.correct
              ? `<span class="result-player">${res.actualPlayer.name}</span>`
              : `<span style="color:var(--red);text-decoration:line-through;font-size:0.85rem;">${res.guessedPlayer?.name || '???'}</span>
                 <span style="color:var(--text-muted);margin:0 3px;">â†’</span>
                 <span class="result-player">${res.actualPlayer.name}</span>`
            }
          </div>
        </div>
      `).join('')}
    </div>

    ${msg.bestAnswer ? `
      <div class="card" style="text-align: center;">
        <div style="font-size: 1rem; margin-bottom: 2px;">â­ Best Answer</div>
        <div style="font-weight: 700; font-size: 1rem; color: var(--purple);">"${escapeHtml(msg.bestAnswer.text)}"</div>
        <div style="color: var(--green); font-weight: 700; margin-top: 4px; font-size: 0.88rem;">â€” ${msg.bestAnswer.player} (+1)</div>
      </div>
    ` : ''}

    ${msg.funniestAnswer ? `
      <div class="card" style="text-align: center;">
        <div style="font-size: 1rem; margin-bottom: 2px;">ğŸ˜‚ Funniest Answer</div>
        <div style="font-weight: 700; font-size: 1rem; color: var(--purple);">"${escapeHtml(msg.funniestAnswer.text)}"</div>
        <div style="color: var(--green); font-weight: 700; margin-top: 4px; font-size: 0.88rem;">â€” ${msg.funniestAnswer.player} (+1)</div>
      </div>
    ` : ''}

    <div class="card">
      <label>Scoreboard</label>
      ${msg.scoreboard.map((p, i) => `
        <div class="score-row" style="animation-delay: ${i * 0.08}s">
          <div class="score-rank">${i === 0 ? 'ğŸ‘‘' : `${i + 1}`}</div>
          <div class="score-name">${getAvatar(p.id)} ${p.name} ${p.id === myId ? '<span class="status-badge you">You</span>' : ''}</div>
          <div class="score-points">${p.score} pts</div>
        </div>
      `).join('')}
    </div>

    ${isHost ? `
      <button class="btn btn-primary btn-full" id="btn-next-turn" style="margin-top: 14px;">Next Turn â†’</button>
    ` : `
      <p style="text-align: center; color: var(--text-muted); margin-top: 14px; font-size: 0.88rem;" class="waiting-dots">Waiting for host</p>
    `}
  `;

  if (isHost) {
    document.getElementById('btn-next-turn').onclick = () => send({ type: 'next_turn' });
  }
}

function renderGameOver(msg) {
  showScreen('game');
  const gc = document.getElementById('game-content');
  const winner = msg.scoreboard[0];

  launchConfetti();

  gc.innerHTML = `
    <div class="phase-header" style="margin-top: 32px;">
      <div class="phase-title" style="font-size: 2rem;">Game Over!</div>
    </div>

    <div class="winner-banner">
      <div style="font-size: 2.4rem;">ğŸ†</div>
      <div class="winner-name">${winner.name}</div>
      <div style="color: var(--text-secondary); font-weight: 700; margin-top: 2px;">${winner.score} points</div>
    </div>

    <div class="card">
      <label>Final Standings</label>
      ${msg.scoreboard.map((p, i) => `
        <div class="score-row" style="animation-delay: ${i * 0.08}s">
          <div class="score-rank">${i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : `${i + 1}`}</div>
          <div class="score-name">${getAvatar(p.id)} ${p.name} ${p.id === myId ? '<span class="status-badge you">You</span>' : ''}</div>
          <div class="score-points">${p.score} pts</div>
        </div>
      `).join('')}
    </div>

    ${isHost ? `
      <button class="btn btn-primary btn-full" style="margin-top: 14px;" id="btn-play-again">Play Again</button>
    ` : ''}
  `;

  if (isHost) {
    document.getElementById('btn-play-again').onclick = () => send({ type: 'play_again' });
  }
}

// â”€â”€â”€ TIMER DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startTimerDisplay(totalSeconds, endsAt) {
  clearInterval(timerInterval);
  timerEnd = endsAt;
  const totalMs = totalSeconds * 1000;

  timerInterval = setInterval(() => {
    const remaining = Math.max(0, timerEnd - Date.now());
    const pct = (remaining / totalMs) * 100;
    const secs = Math.ceil(remaining / 1000);

    const fill = document.getElementById('timer-fill');
    const text = document.getElementById('timer-text');

    if (fill) {
      fill.style.width = pct + '%';
      fill.classList.toggle('urgent', pct < 20);
    }
    if (text) {
      text.textContent = secs + 's';
      text.classList.toggle('urgent', pct < 20);
    }

    if (remaining <= 0) clearInterval(timerInterval);
  }, 250);
}

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const avatars = ['ğŸ¦Š','ğŸ¸','ğŸ¦‰','ğŸ™','ğŸ¦‹','ğŸº','ğŸ¦','ğŸ¨','ğŸ¦„','ğŸ¢'];
function getAvatar(id) {
  let hash = 0;
  for (let i = 0; i < id.length; i++) hash = ((hash << 5) - hash) + id.charCodeAt(i);
  return avatars[Math.abs(hash) % avatars.length];
}

function escapeHtml(s) {
  const div = document.createElement('div');
  div.textContent = s;
  return div.innerHTML;
}

function showToast(text) {
  const t = document.getElementById('toast');
  t.textContent = text;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

function launchConfetti() {
  const colors = ['#1A8C4E', '#2D1B4E', '#22C55E', '#D97706', '#4A3270', '#14693A'];
  for (let i = 0; i < 50; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + 'vw';
    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
    piece.style.animationDelay = Math.random() * 2 + 's';
    piece.style.animationDuration = (2 + Math.random() * 2) + 's';
    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    piece.style.width = (5 + Math.random() * 7) + 'px';
    piece.style.height = (5 + Math.random() * 7) + 'px';
    document.body.appendChild(piece);
    setTimeout(() => piece.remove(), 5000);
  }
}

// â”€â”€â”€ EVENT LISTENERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('btn-create').onclick = () => {
  const name = document.getElementById('input-name').value.trim();
  if (!name) return showToast('Enter your name!');
  send({ type: 'create_lobby', name });
};

document.getElementById('btn-show-join').onclick = () => {
  const section = document.getElementById('join-section');
  section.style.display = section.style.display === 'none' ? 'block' : 'none';
  if (section.style.display === 'block') document.getElementById('input-code').focus();
};

document.getElementById('btn-join').onclick = () => {
  const name = document.getElementById('input-name').value.trim();
  const code = document.getElementById('input-code').value.trim();
  if (!name) return showToast('Enter your name!');
  if (!code) return showToast('Enter a lobby code!');
  send({ type: 'join_lobby', name, code });
};

document.getElementById('btn-start').onclick = () => {
  send({ type: 'start_game' });
};

document.getElementById('display-code').onclick = () => {
  navigator.clipboard?.writeText(lobbyCode);
  showToast('Code copied!');
};

document.getElementById('input-name').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') document.getElementById('btn-create').click();
});
document.getElementById('input-code').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') document.getElementById('btn-join').click();
});

// â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id) {
  document.getElementById(id).classList.add('open');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// Welcome modal â€” show on first visit
const hasPlayed = sessionStorage.getItem('whodat-has-played');
if (!hasPlayed) {
  // Small delay so the page renders first
  setTimeout(() => openModal('modal-welcome'), 400);
}

document.getElementById('btn-welcome-yes').onclick = () => {
  sessionStorage.setItem('whodat-has-played', '1');
  closeModal('modal-welcome');
};

document.getElementById('btn-welcome-no').onclick = () => {
  sessionStorage.setItem('whodat-has-played', '1');
  closeModal('modal-welcome');
  setTimeout(() => openModal('modal-rules'), 250);
};

// Rules modal
document.getElementById('btn-rules-close').onclick = () => {
  closeModal('modal-rules');
};

// How to Play link on home screen
document.getElementById('btn-how-to-play').onclick = () => {
  openModal('modal-rules');
};

// Close modals by clicking overlay background
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) {
      overlay.classList.remove('open');
    }
  });
});

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
connect();
</script>
</body>
</html>